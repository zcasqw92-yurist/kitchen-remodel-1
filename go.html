<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- 100% защита от передачи домена преленда (homesupplycenter) в партнерку -->
    <meta name="referrer" content="no-referrer">
    <title>Loading your options...</title>

    <script>
        // 1. Ваша чистая трекинговая ссылка Marketcall
        var baseAffiliateLink = "https://trkmcl.com/7o4z7mo89q/d8qw9z7l8o";

        // 2. Читаем параметры, которые передал преленд (через обновленную кнопку)
        var urlParams = new URLSearchParams(window.location.search);
        var source = urlParams.get('source') || 'unknown'; 
        var keyword = urlParams.get('sub1');     // Ловим ключевое слово
        var customAdId = urlParams.get('sub2');  // Ловим ID креатива

        // 3. Формируем финальную ссылку для Marketcall
        var finalLink = baseAffiliateLink;
        var separator = finalLink.indexOf('?') !== -1 ? '&' : '?';
        finalLink += separator;
        
        var paramsToAppend = [];

        // Умная маршрутизация трафика
        if (source === 'paid' || keyword || customAdId) {
            // === ТРАФИК С ПЛАТНОЙ РЕКЛАМЫ PINTEREST ===
            paramsToAppend.push("utm_source=pinterest_paid");
            
            if (keyword) {
                // ВАЖНО: Для Marketcall ключ передаем строго в параметр subid
                paramsToAppend.push("subid=" + encodeURIComponent(keyword));
            }
            
            if (customAdId) {
                // ID креатива передаем в параметр subid1
                paramsToAppend.push("subid1=" + encodeURIComponent(customAdId));
            } else {
                // Заглушка, чтобы менеджеры партнерки не искали наши пины
                paramsToAppend.push("subid1=creo_unknown"); 
            }

        } else if (source === 'organic') {
            // === ТРАФИК С БЕСПЛАТНЫХ ПИНОВ (Органика) ===
            paramsToAppend.push("utm_source=pinterest_organic");

        } else {
            // === ПРЯМОЙ ЗАХОД ===
            paramsToAppend.push("utm_source=direct");
        }

        // Склеиваем всё вместе
        finalLink += paramsToAppend.join('&');

        // 4. Мгновенный редирект (заменяем URL, чтобы юзер не мог нажать кнопку "Назад" и сломать воронку)
        window.location.replace(finalLink);
    </script>
</head>
<body>
    <!-- Резервный редирект на случай, если у пользователя в браузере отключен JavaScript -->
    <noscript>
        <meta http-equiv="refresh" content="0; url=https://trkmcl.com/7o4z7mo89q/d8qw9z7l8o">
    </noscript>
</body>
</html>
